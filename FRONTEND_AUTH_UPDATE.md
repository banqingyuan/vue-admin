# å‰ç«¯è®¤è¯ç³»ç»Ÿæ›´æ–°æ€»ç»“

## æ¦‚è¿°

ä¸ºäº†ä¸åç«¯è®¤è¯ç³»ç»Ÿä¿æŒä¸€è‡´ï¼Œå·²å°†æ‰€æœ‰å‰ç«¯åº”ç”¨çš„è®¤è¯æ¥å£ä»æ—§çš„ `/auth/*` ç³»ç»Ÿè¿ç§»åˆ°æ–°çš„ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ `/admin/auth/*`ã€‚

## æ›´æ–°çš„åº”ç”¨

### âœ… å½“å‰ä½¿ç”¨çš„åº”ç”¨ï¼š

1. **web-antd** - ä½¿ç”¨ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ
2. **playground** - ä½¿ç”¨ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ

### ğŸ—‘ï¸ å·²åˆ é™¤çš„åº”ç”¨ï¼š

- **web-naive** - å·²åˆ é™¤ï¼ˆä¸å†ä½¿ç”¨ï¼‰
- **web-ele** - å·²åˆ é™¤ï¼ˆä¸å†ä½¿ç”¨ï¼‰

## ä¸»è¦å˜æ›´

### 1. æ¥å£åœ°å€å˜æ›´

#### æ—§æ¥å£ (å·²åºŸå¼ƒ)

```typescript
// ç™»å½•
POST / auth / login;
// åˆ·æ–°token
POST / auth / refresh;
// é€€å‡ºç™»å½•
POST / auth / logout;
// è·å–æƒé™ç 
GET / auth / codes;
```

#### æ–°æ¥å£ (ç°åœ¨ä½¿ç”¨)

```typescript
// å‘é€éªŒè¯ç 
POST / admin / auth / send - code;
// éªŒè¯ç ç™»å½•
POST / admin / auth / login;
// é€€å‡ºç™»å½•
POST / admin / auth / logout;
// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
GET / admin / auth / me;
// è·å–æƒé™ç  (ä»ä½¿ç”¨æ—§åœ°å€ï¼Œä½†éœ€è¦ç®¡ç†å‘˜è®¤è¯)
GET / auth / codes;
```

### 2. æ¥å£å‚æ•°å˜æ›´

#### æ—§ç™»å½•æ¥å£

```typescript
interface LoginParams {
  password?: string;
  username?: string;
}

interface LoginResult {
  accessToken: string;
}
```

#### æ–°ç™»å½•æ¥å£

```typescript
interface SendSMSCodeParams {
  phone_number: string;
}

interface LoginParams {
  phone_number: string;
  code: string;
}

interface LoginResult {
  token: string;
  user: {
    admin_user_id: number;
    phone: string;
    username: string;
    role: string;
    status: string;
  };
  message: string;
}
```

### 3. æ–°å¢æ¥å£

#### å‘é€éªŒè¯ç 

```typescript
export async function sendSMSCodeApi(data: AuthApi.SendSMSCodeParams) {
  return baseRequestClient.post<AuthApi.SendSMSCodeResult>(
    '/admin/auth/send-code',
    data,
  );
}
```

#### è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```typescript
export async function getCurrentUserApi() {
  return requestClient.get('/admin/auth/me');
}
```

## æ›´æ–°çš„æ–‡ä»¶

### æ ¸å¿ƒè®¤è¯æ–‡ä»¶

- `apps/web-antd/src/api/core/auth.ts` âœ… (ä½¿ç”¨ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ)
- `playground/src/api/core/auth.ts` âœ… (å·²æ›´æ–°åˆ°ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ)
- ~~`apps/web-naive/src/api/core/auth.ts`~~ (åº”ç”¨å·²åˆ é™¤)
- ~~`apps/web-ele/src/api/core/auth.ts`~~ (åº”ç”¨å·²åˆ é™¤)

## è®¤è¯æµç¨‹å˜æ›´

### æ—§æµç¨‹

1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
2. è°ƒç”¨ `/auth/login` æ¥å£
3. è·å– `accessToken`
4. ä½¿ç”¨ token è®¿é—®å…¶ä»–æ¥å£

### æ–°æµç¨‹

1. ç”¨æˆ·è¾“å…¥æ‰‹æœºå·
2. è°ƒç”¨ `/admin/auth/send-code` å‘é€éªŒè¯ç 
3. ç”¨æˆ·è¾“å…¥éªŒè¯ç 
4. è°ƒç”¨ `/admin/auth/login` ç™»å½•
5. è·å–ç®¡ç†å‘˜ `token` å’Œç”¨æˆ·ä¿¡æ¯
6. ä½¿ç”¨ token è®¿é—®å…¶ä»–æ¥å£

## å…¼å®¹æ€§è¯´æ˜

### æƒé™ç æ¥å£

- `/auth/codes` æ¥å£åœ°å€ä¿æŒä¸å˜
- ä½†ç°åœ¨éœ€è¦ç®¡ç†å‘˜è®¤è¯æ‰èƒ½è®¿é—®
- è¿”å›çš„æƒé™ç åŸºäºç®¡ç†å‘˜è§’è‰²

### Token æ ¼å¼

- æ–°çš„ token æ˜¯ç®¡ç†å‘˜ JWT token
- åŒ…å«ç®¡ç†å‘˜ç”¨æˆ·ä¿¡æ¯ (admin_user_id, phone, username, role)
- ä½¿ç”¨ç‹¬ç«‹çš„ JWT secret ç­¾å

## å‰ç«¯éœ€è¦æ³¨æ„çš„äº‹é¡¹

### 1. ç™»å½•è¡¨å•æ›´æ–°

å‰ç«¯ç™»å½•è¡¨å•éœ€è¦ä»ç”¨æˆ·å/å¯†ç æ¨¡å¼æ”¹ä¸ºæ‰‹æœºå·/éªŒè¯ç æ¨¡å¼ï¼š

```vue
<!-- æ—§è¡¨å• -->
<input v-model="username" placeholder="ç”¨æˆ·å" />
<input v-model="password" type="password" placeholder="å¯†ç " />

<!-- æ–°è¡¨å• -->
<input v-model="phone_number" placeholder="æ‰‹æœºå·" />
<input v-model="code" placeholder="éªŒè¯ç " />
<button @click="sendCode">å‘é€éªŒè¯ç </button>
```

### 2. Token å­˜å‚¨

- Token å­—æ®µåä» `accessToken` æ”¹ä¸º `token`
- éœ€è¦åŒæ—¶å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ (user å¯¹è±¡)

### 3. é”™è¯¯å¤„ç†

- æ–°æ¥å£çš„é”™è¯¯å“åº”æ ¼å¼å¯èƒ½ä¸åŒ
- éœ€è¦å¤„ç†éªŒè¯ç ç›¸å…³çš„é”™è¯¯ (å‘é€é¢‘ç‡é™åˆ¶ã€éªŒè¯ç é”™è¯¯ç­‰)

### 4. ç”¨æˆ·ä¿¡æ¯è·å–

- å¯ä»¥é€šè¿‡ `/admin/auth/me` æ¥å£è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- ç”¨æˆ·ä¿¡æ¯ç»“æ„å·²å˜æ›´ï¼ŒåŒ…å«ç®¡ç†å‘˜ç‰¹æœ‰å­—æ®µ

## æµ‹è¯•å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•

- æµ‹è¯•å‘é€éªŒè¯ç åŠŸèƒ½
- æµ‹è¯•éªŒè¯ç ç™»å½•æµç¨‹
- æµ‹è¯•æƒé™ç è·å–
- æµ‹è¯•é€€å‡ºç™»å½•

### 2. é”™è¯¯åœºæ™¯æµ‹è¯•

- æ— æ•ˆæ‰‹æœºå·
- éªŒè¯ç é”™è¯¯
- éªŒè¯ç è¿‡æœŸ
- å‘é€é¢‘ç‡é™åˆ¶
- Token è¿‡æœŸ

### 3. å…¼å®¹æ€§æµ‹è¯•

- ç¡®ä¿æ‰€æœ‰åº”ç”¨éƒ½èƒ½æ­£å¸¸ç™»å½•
- ç¡®ä¿æƒé™æ§åˆ¶æ­£å¸¸å·¥ä½œ
- ç¡®ä¿ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®

## åç»­å·¥ä½œ

1. **æ›´æ–°ç™»å½•é¡µé¢UI** - å°†ç”¨æˆ·å/å¯†ç è¡¨å•æ”¹ä¸ºæ‰‹æœºå·/éªŒè¯ç è¡¨å•
2. **æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º** - é€‚é…æ–°çš„ç”¨æˆ·ä¿¡æ¯ç»“æ„
3. **å®Œå–„é”™è¯¯å¤„ç†** - å¤„ç†éªŒè¯ç ç›¸å…³çš„å„ç§é”™è¯¯åœºæ™¯
4. **æµ‹è¯•æ‰€æœ‰åŠŸèƒ½** - ç¡®ä¿è®¤è¯ç³»ç»Ÿåœ¨æ‰€æœ‰åº”ç”¨ä¸­æ­£å¸¸å·¥ä½œ

## æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦**: ç”±äºåç«¯å·²ç»åˆ é™¤äº† `/api/auth/*` è·¯ç”±ç»„ï¼Œä½¿ç”¨æ—§æ¥å£çš„å‰ç«¯åº”ç”¨å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚æ‰€æœ‰åº”ç”¨éƒ½å¿…é¡»æ›´æ–°åˆ°æ–°çš„è®¤è¯ç³»ç»Ÿã€‚

âœ… **å·²å®Œæˆ**:

- æ‰€æœ‰å½“å‰ä½¿ç”¨çš„å‰ç«¯åº”ç”¨ï¼ˆweb-antd, playgroundï¼‰çš„ API æ¥å£å·²æ›´æ–°å®Œæˆï¼Œç°åœ¨éƒ½ä½¿ç”¨ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ
- å·²åˆ é™¤ä¸å†ä½¿ç”¨çš„åº”ç”¨ï¼ˆweb-naive, web-eleï¼‰
